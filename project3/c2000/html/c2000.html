
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>c2000</title><meta name="generator" content="MATLAB 7.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2013-11-19"><meta name="DC.source" content="c2000.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }

  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">1 - Sixth-Order Digital Butterworth Lowpass IIR Filter</a></li><li><a href="#3">2 - Sixth-Order Digital Chebyshev Lowpass IIR Filter</a></li><li><a href="#4">3 - Sixth-Order Digital Elliptic Lowpass IIR Filter</a></li><li><a href="#5">4 - Compare the Order of the Three Filter Design Methods</a></li><li><a href="#6">5 - Rectangular and Hamming Window Design</a></li><li><a href="#7">6 - Kaiser Window Design</a></li><li><a href="#8">7 - Optimal Lowpass Filter</a></li><li><a href="#9">8 - Varying the Passband Edge</a></li><li><a href="#10">9 - Varying the Transition Bandwidth</a></li><li><a href="#11">10 - Optimal vs. Window FIR Design</a></li><li><a href="#12">11 - Changing Filter Length</a></li><li><a href="#13">12 - Optimal FIR vs. Elliptic IIR Design</a></li></ul></div><pre class="codeinput"><span class="comment">% Jen Tashman, Joe Marcedes, John Biswakarma</span>
<span class="comment">% ECE 114</span>
<span class="comment">% MATLAB Assignment #3 (2000c): IIR and FIR Filter Design</span>

<span class="comment">% remember to cirlce the alternation points on the plots in 7 and 8</span>

clear <span class="string">all</span>; close <span class="string">all</span>; clc;

<span class="comment">% IIR Filter Design</span>
</pre><h2>1 - Sixth-Order Digital Butterworth Lowpass IIR Filter<a name="2"></a></h2><pre class="codeinput">figure;
[a,b] = butter(6,0.33);
freqz(a,b);

figure;
zplane(a,b);8

figure;
impz(a,b,20);
</pre><pre class="codeoutput">
ans =

     8

</pre><img vspace="5" hspace="5" src="c2000_01.png" alt=""> <img vspace="5" hspace="5" src="c2000_02.png" alt=""> <img vspace="5" hspace="5" src="c2000_03.png" alt=""> <h2>2 - Sixth-Order Digital Chebyshev Lowpass IIR Filter<a name="3"></a></h2><pre class="codeinput">figure;
[a,b] = cheby1(6,0.5,0.33);
freqz(a,b);

figure;
zplane(a,b);

figure;
impz(a,b,20);
</pre><img vspace="5" hspace="5" src="c2000_04.png" alt=""> <img vspace="5" hspace="5" src="c2000_05.png" alt=""> <img vspace="5" hspace="5" src="c2000_06.png" alt=""> <h2>3 - Sixth-Order Digital Elliptic Lowpass IIR Filter<a name="4"></a></h2><pre class="codeinput">figure;
[a,b] = ellip(6,0.5,30,0.33);
freqz(a,b);

figure;
zplane(a,b);

figure;
impz(a,b,20);
</pre><img vspace="5" hspace="5" src="c2000_07.png" alt=""> <img vspace="5" hspace="5" src="c2000_08.png" alt=""> <img vspace="5" hspace="5" src="c2000_09.png" alt=""> <h2>4 - Compare the Order of the Three Filter Design Methods<a name="5"></a></h2><pre class="codeinput">[n1,Wn] = buttord(0.45,0.5,0.1,40);  <span class="comment">% minimum order = 42</span>
[n2,Wn] = cheb1ord(0.45,0.5,0.1,40); <span class="comment">% minimum order = 13</span>
[n3,Wn] = ellipord(0.45,0.5,0.1,40); <span class="comment">% minimum order = 7</span>
</pre><h2>5 - Rectangular and Hamming Window Design<a name="6"></a></h2><pre class="codeinput">wc = 0.33*pi;
n = (0:28);
idfilt = sin(wc.*(n-14))./(pi*(n-14));
idfilt(15) = (1/pi);
rect = rectwin(29)';
win1 = idfilt.*rect;
figure;
stem(n,win1);
title(<span class="string">'Impulse Response of Rectangular Window'</span>);
xlabel(<span class="string">'Time (n)'</span>);
ylabel(<span class="string">'Amplitude'</span>);

[h1,w1] = freqz(win1);
w1 = w1/pi;
figure;
plot(w1,abs(h1));
axis([0 1 -.25 1.25]);
title(<span class="string">'Frequency Response of Rectangular Window'</span>);
xlabel(<span class="string">'Frequency (Hz)/pi'</span>);
ylabel(<span class="string">'Magnitude'</span>);

<span class="comment">% high passband ripple limit = 1.0815</span>
<span class="comment">% low passband ripple limit = 0.9345</span>
<span class="comment">% passband edge frequency (normalized by pi) = 0.2958</span>
<span class="comment">% stopband ripple limit = 0.0996</span>
<span class="comment">% stopband edge frequency (normalized by pi) = 0.3585</span>

ham = hamming(29)';
win2 = idfilt.*ham;
figure;
stem(n,win2);
title(<span class="string">'Impulse Response of Hamming Window'</span>);
xlabel(<span class="string">'Time (n)'</span>);
ylabel(<span class="string">'Amplitude'</span>);

[h2,w2] = freqz(win2);
w2 = w2/pi;
figure;
plot(w2,abs(h2));
axis([0 1 -.25 1.25]);
title(<span class="string">'Frequency Response of Hamming Window'</span>);
xlabel(<span class="string">'Frequency (Hz)/pi'</span>);
ylabel(<span class="string">'Magnitude'</span>);

<span class="comment">% high passband ripple limit = 0.9912</span>
<span class="comment">% low passband ripple limit = 0.986</span>
<span class="comment">% passband edge frequency (normalized by pi) = 0.2077</span>
<span class="comment">% stopband ripple limit = 0.014</span>
<span class="comment">% stopband edge frequency (normalized by pi) = 0.4245</span>
</pre><img vspace="5" hspace="5" src="c2000_10.png" alt=""> <img vspace="5" hspace="5" src="c2000_11.png" alt=""> <img vspace="5" hspace="5" src="c2000_12.png" alt=""> <img vspace="5" hspace="5" src="c2000_13.png" alt=""> <h2>6 - Kaiser Window Design<a name="7"></a></h2><pre class="codeinput">kai1 = kaiser(29,4)';
win3 = idfilt.*kai1;
figure;
stem(n,win3);
title(<span class="string">'Impulse Response of Kaiser Window, Beta = 4'</span>);
xlabel(<span class="string">'Time (n)'</span>);
ylabel(<span class="string">'Amplitude'</span>);

[h3,w3] = freqz(win3);
w3 = w3/pi;
figure;
plot(w3,abs(h3));
axis([0 1 -.25 1.25]);
title(<span class="string">'Frequency Response of Kaiser Window, Beta = 4'</span>);
xlabel(<span class="string">'Frequency (Hz)/pi'</span>);
ylabel(<span class="string">'Magnitude'</span>);

<span class="comment">% high passband ripple limit = 0.9923</span>
<span class="comment">% low passband ripple limit = 0.9865</span>
<span class="comment">% passband edge frequency (normalized by pi) = 0.2314</span>
<span class="comment">% stopband ripple limit = 0.0157</span>
<span class="comment">% stopband edge frequency (normalized by pi) = 0.4097</span>

kai2 = kaiser(29,6)';
win4 = idfilt.*kai2;
figure;
stem(n,win4);
title(<span class="string">'Impulse Response of Hamming Window, Beta = 6'</span>);
xlabel(<span class="string">'Time (n)'</span>);
ylabel(<span class="string">'Amplitude'</span>);

[h4,w4] = freqz(win4);
w4 = w4/pi;
figure;
plot(w4,abs(h4));
axis([0 1 -.25 1.25]);
title(<span class="string">'Frequency Response of Kaiser Window, Beta = 6'</span>);
xlabel(<span class="string">'Frequency (Hz)/pi'</span>);
ylabel(<span class="string">'Magnitude'</span>);

<span class="comment">% high passband ripple limit = 0.9892</span>
<span class="comment">% low passband ripple limit = 0.9877</span>
<span class="comment">% passband edge frequency (normalized by pi) = 0.1955</span>
<span class="comment">% stopband ripple limit = 0.0125</span>
<span class="comment">% stopband edge frequency (normalized by pi)= 0.4329</span>
</pre><img vspace="5" hspace="5" src="c2000_14.png" alt=""> <img vspace="5" hspace="5" src="c2000_15.png" alt=""> <img vspace="5" hspace="5" src="c2000_16.png" alt=""> <img vspace="5" hspace="5" src="c2000_17.png" alt=""> <h2>7 - Optimal Lowpass Filter<a name="8"></a></h2><pre class="codeinput">h = firpm(28, [0 0.30 0.36 1], [1 1 0 0]);
n = (0:28);
[h5,w5] = freqz(h);
w5 = w5/pi;
figure;
plot(w5,abs(h5));

h5 = abs(h5);
ind = find(w5&gt;0.3);
ind = ind(1);
h51 = h5(1:ind);
maxpass = max(h51)-1;
minpass = 1-min(h51);
del_p = max(maxpass,minpass);

ind2 = find(w5&gt;0.36);
ind2 = ind2(1);
h52 = h5(ind2:end);
maxpass2 = max(h52);
del_s = maxpass2;

<span class="comment">% There are six alternation points in the passband</span>
<span class="comment">% There are ten alternation points in the stopband</span>
</pre><img vspace="5" hspace="5" src="c2000_18.png" alt=""> <h2>8 - Varying the Passband Edge<a name="9"></a></h2><pre class="codeinput">fp = 0.27;
h = firpm(28, [0 fp 0.36 1], [1 1 0 0]);
n = (0:28);
[h6,w6] = freqz(h);
w6 = w6/pi;
figure;
plot(w6,abs(h6));

h6 = abs(h6);
ind = find(w6&gt;fp);
ind = ind(1);
h61 = h6(1:ind);
maxpass = max(h61)-1;
minpass = 1-min(h61);
del_p = max(maxpass,minpass);

ind2 = find(w6&gt;0.36);
ind2 = ind2(1);
h62 = h6(ind2:end);
maxpass2 = max(h62);
del_s = maxpass2;

<span class="comment">% There are five alternation points in the passband</span>
<span class="comment">% There are 11 alternation points in the stopband</span>

fp = 0.33;
h = firpm(28, [0 fp 0.36 1], [1 1 0 0]);
n = (0:28);
[h6,w6] = freqz(h);
w6 = w6/pi;
figure;
plot(w6,abs(h6));

h6 = abs(h6);
ind = find(w6&gt;fp);
ind = ind(1);
h61 = h6(1:ind);
maxpass = max(h61)-1;
minpass = 1-min(h61);
del_p = max(maxpass,minpass);

ind2 = find(w6&gt;0.36);
ind2 = ind2(1);
h62 = h6(ind2:end);
maxpass2 = max(h62);
del_s = maxpass2;

<span class="comment">% There are six alternation points in the passband</span>
<span class="comment">% There are 10 alternation points in the stopband</span>
</pre><img vspace="5" hspace="5" src="c2000_19.png" alt=""> <img vspace="5" hspace="5" src="c2000_20.png" alt=""> <h2>9 - Varying the Transition Bandwidth<a name="10"></a></h2><pre class="codeinput">tbw = 0.15
h = firpm(28, [0 0.33-tbw 0.33+tbw 1], [1 1 0 0]);
fp = 0.33-tbw;
fs = 0.33+tbw;
n = (0:28);
[h7,w7] = freqz(h);
w7 = w7/pi;
figure;
plot(w7,abs(h7));

h7 = abs(h7);
ind = find(w7&gt;fp);
ind = ind(1);
h71 = h7(1:ind);
maxpass = max(h71)-1;
minpass = 1-min(h71);
del_p = max(maxpass,minpass);

ind2 = find(w7&gt;fs);
ind2 = ind2(1);
h72 = h7(ind2:end);
maxpass2 = max(h72);
del_s = maxpass2;

tbw = 0.01
h = firpm(28, [0 0.33-tbw 0.33+tbw 1], [1 1 0 0]);
fp = 0.33 - tbw;
fs = 0.33 + tbw;
n = (0:28);
[h8,w8] = freqz(h);
w8 = w8/pi;
figure;
plot(w8,abs(h8));

h8 = abs(h8);
ind = find(w8&gt;fp);
ind = ind(1);
h81 = h8(1:ind);
maxpass = max(h81)-1;
minpass = 1-min(h81);
del_p = max(maxpass,minpass);

ind2 = find(w8&gt;fs);
ind2 = ind2(1);
h82 = h8(ind2:end);
maxpass2 = max(h82);
del_s = maxpass2;
</pre><pre class="codeoutput">
tbw =

    0.1500


tbw =

    0.0100

</pre><img vspace="5" hspace="5" src="c2000_21.png" alt=""> <img vspace="5" hspace="5" src="c2000_22.png" alt=""> <h2>10 - Optimal vs. Window FIR Design<a name="11"></a></h2><pre class="codeinput">wp = 0.1955;
ws = 0.4329;
h = firpm(28, [0 wp ws 1], [1 1 0 0]);
n = (0:28);
[h9,w9] = freqz(h);
h9 = abs(h9);
w9 = w9/pi;

ind1 = find(w9&gt;wp);
ind1 = ind1(1);
h91 = h9(1:ind1);
maxpass = max(h91)-1;
minpass = 1-min(h91);
del_p = max(maxpass,minpass);

ind2 = find(w9&gt;ws);
ind2 = ind2(1);
h92 = h9(ind2:end);
maxpass2 = max(h92);
del_s = maxpass2;

figure;
plot(w9,h9);
axis([0 wp .998, 1.002]);

figure;
plot(w9,h9);
axis([ws 1 0 .004]);

<span class="comment">% This is better than the filter designed with the window method because</span>
<span class="comment">% the del_p and del_s values are reduced</span>
</pre><img vspace="5" hspace="5" src="c2000_23.png" alt=""> <img vspace="5" hspace="5" src="c2000_24.png" alt=""> <h2>11 - Changing Filter Length<a name="12"></a></h2><pre class="codeinput">h = firpm(38, [0 0.3 0.36 1], [1 1 0 0 ]);
n = (0:28);
[H,W] = freqz(h);
H = abs(H);
W = W/pi;

figure;
hold <span class="string">on</span>;
plot(W,H,<span class="string">'r'</span>);
plot(W,h5);
title(<span class="string">'29- and 39-Length Filters'</span>);
xlabel(<span class="string">'Frequency (Hz)'</span>);
ylabel(<span class="string">'Amplitude'</span>);
hleg1 = legend(<span class="string">'Length: 39'</span>,<span class="string">'Length: 29'</span>);

ind1 = find(W&gt;0.3);
ind1 = ind1(1);
H1 = H(1:ind1);
maxpass = max(H1)-1;
minpass = 1-min(H1);
del_p = max(maxpass,minpass);

ind2 = find(W&gt;0.36);
ind2 = ind2(1);
H2 = H(ind2:end);
maxpass2 = max(H2);
del_s = maxpass2;
</pre><img vspace="5" hspace="5" src="c2000_25.png" alt=""> <h2>12 - Optimal FIR vs. Elliptic IIR Design<a name="13"></a></h2><pre class="codeinput">h = firpm(102, [0 0.45 0.5 1], [1 1 0 0], [5 1]);
n = (0:102);
[H,W] = freqz(h);
H = abs(H);
maxH = max(H);
W = W/pi;

ind1 = find(W&gt;0.45);
ind1 = ind1(1);
H1 = H(1:ind1);
maxpass = max(H1)-1;
minpass = 1-min(H1);
del_p = max(maxpass,minpass);

ind2 = find(W&gt;0.5);
ind2 = ind2(1);
H3 = H(ind2:end);
maxpass2 = max(H3);
del_s = maxpass2;

h = firpm(89, [0 0.45 0.5 1], [1-del_p 1-del_p 0 0], [2.56 1]);
[H,W] = freqz(h);
H = abs(H);
maxH2 = max(H);
W = W/pi;

figure;
plot(W,H);
axis([0 1 0 1.1]);

H2 = 20*log10(H);
figure;
plot(W,H2)
axis([0 1 -110 5]);

ind1 = find(W&gt;0.45);
ind1 = ind1(1);
ind1 = H2(1:ind1);
maxpass = max(ind1);
minpass = min(ind1);
idrip = maxpass-minpass; <span class="comment">% ripple</span>
ind2 = find(W&gt;0.5);
ind2 = ind2(1);
ind2 = H2(ind2:end);
maxpass = max(ind2);
atten = minpass-maxpass;

<span class="comment">% The length of the FIR filter is 90, the order is 89</span>

<span class="comment">% The order of the elliptic IIR filter is 7, so:</span>
<span class="comment">% 2(7)+1 = 15 multiplications per output sample are required for the elliptic IIR</span>
<span class="comment">% filter, where n is the order of the IIR filter.</span>

<span class="comment">% The order is 89, so 89 multiplcations per output sample are required for the optimal FIR</span>
<span class="comment">% filter using direct convolution, where n is the order of the FIR filter.</span>

<span class="comment">% The error weighting of the passband: 2.56</span>
<span class="comment">% The error weighting of the stopband: 1</span>
</pre><img vspace="5" hspace="5" src="c2000_26.png" alt=""> <img vspace="5" hspace="5" src="c2000_27.png" alt=""> <p class="footer"><br>
      Published with MATLAB&reg; 7.14<br></p></div><!--
##### SOURCE BEGIN #####
% Jen Tashman, Joe Marcedes, John Biswakarma
% ECE 114
% MATLAB Assignment #3 (2000c): IIR and FIR Filter Design

% remember to cirlce the alternation points on the plots in 7 and 8

clear all; close all; clc;

% IIR Filter Design

%% 1 - Sixth-Order Digital Butterworth Lowpass IIR Filter
figure;
[a,b] = butter(6,0.33);
freqz(a,b);

figure;
zplane(a,b);8

figure;
impz(a,b,20);

%% 2 - Sixth-Order Digital Chebyshev Lowpass IIR Filter
figure;
[a,b] = cheby1(6,0.5,0.33);
freqz(a,b);

figure;
zplane(a,b);

figure;
impz(a,b,20);

%% 3 - Sixth-Order Digital Elliptic Lowpass IIR Filter
figure;
[a,b] = ellip(6,0.5,30,0.33);
freqz(a,b);

figure;
zplane(a,b);

figure;
impz(a,b,20);

%% 4 - Compare the Order of the Three Filter Design Methods

[n1,Wn] = buttord(0.45,0.5,0.1,40);  % minimum order = 42
[n2,Wn] = cheb1ord(0.45,0.5,0.1,40); % minimum order = 13
[n3,Wn] = ellipord(0.45,0.5,0.1,40); % minimum order = 7

%% 5 - Rectangular and Hamming Window Design

wc = 0.33*pi;
n = (0:28);
idfilt = sin(wc.*(n-14))./(pi*(n-14));
idfilt(15) = (1/pi);
rect = rectwin(29)';
win1 = idfilt.*rect;
figure;
stem(n,win1);
title('Impulse Response of Rectangular Window');
xlabel('Time (n)');
ylabel('Amplitude');

[h1,w1] = freqz(win1);
w1 = w1/pi;
figure;
plot(w1,abs(h1));
axis([0 1 -.25 1.25]);
title('Frequency Response of Rectangular Window');
xlabel('Frequency (Hz)/pi');
ylabel('Magnitude');

% high passband ripple limit = 1.0815
% low passband ripple limit = 0.9345
% passband edge frequency (normalized by pi) = 0.2958
% stopband ripple limit = 0.0996
% stopband edge frequency (normalized by pi) = 0.3585

ham = hamming(29)';
win2 = idfilt.*ham;
figure;
stem(n,win2);
title('Impulse Response of Hamming Window');
xlabel('Time (n)');
ylabel('Amplitude');

[h2,w2] = freqz(win2);
w2 = w2/pi;
figure;
plot(w2,abs(h2));
axis([0 1 -.25 1.25]);
title('Frequency Response of Hamming Window');
xlabel('Frequency (Hz)/pi');
ylabel('Magnitude');

% high passband ripple limit = 0.9912
% low passband ripple limit = 0.986
% passband edge frequency (normalized by pi) = 0.2077
% stopband ripple limit = 0.014
% stopband edge frequency (normalized by pi) = 0.4245

%% 6 - Kaiser Window Design

kai1 = kaiser(29,4)';
win3 = idfilt.*kai1;
figure;
stem(n,win3);
title('Impulse Response of Kaiser Window, Beta = 4');
xlabel('Time (n)');
ylabel('Amplitude');

[h3,w3] = freqz(win3);
w3 = w3/pi;
figure;
plot(w3,abs(h3));
axis([0 1 -.25 1.25]);
title('Frequency Response of Kaiser Window, Beta = 4');
xlabel('Frequency (Hz)/pi');
ylabel('Magnitude');

% high passband ripple limit = 0.9923
% low passband ripple limit = 0.9865
% passband edge frequency (normalized by pi) = 0.2314
% stopband ripple limit = 0.0157
% stopband edge frequency (normalized by pi) = 0.4097

kai2 = kaiser(29,6)';
win4 = idfilt.*kai2;
figure;
stem(n,win4);
title('Impulse Response of Hamming Window, Beta = 6');
xlabel('Time (n)');
ylabel('Amplitude');

[h4,w4] = freqz(win4);
w4 = w4/pi;
figure;
plot(w4,abs(h4));
axis([0 1 -.25 1.25]);
title('Frequency Response of Kaiser Window, Beta = 6');
xlabel('Frequency (Hz)/pi');
ylabel('Magnitude');

% high passband ripple limit = 0.9892
% low passband ripple limit = 0.9877
% passband edge frequency (normalized by pi) = 0.1955
% stopband ripple limit = 0.0125
% stopband edge frequency (normalized by pi)= 0.4329

%% 7 - Optimal Lowpass Filter
h = firpm(28, [0 0.30 0.36 1], [1 1 0 0]);
n = (0:28);
[h5,w5] = freqz(h);
w5 = w5/pi;
figure;
plot(w5,abs(h5)); 

h5 = abs(h5);
ind = find(w5>0.3);
ind = ind(1);
h51 = h5(1:ind);
maxpass = max(h51)-1;
minpass = 1-min(h51);
del_p = max(maxpass,minpass);

ind2 = find(w5>0.36);
ind2 = ind2(1);
h52 = h5(ind2:end);
maxpass2 = max(h52);
del_s = maxpass2;

% There are six alternation points in the passband
% There are ten alternation points in the stopband

%% 8 - Varying the Passband Edge
fp = 0.27;
h = firpm(28, [0 fp 0.36 1], [1 1 0 0]);
n = (0:28);
[h6,w6] = freqz(h);
w6 = w6/pi;
figure;
plot(w6,abs(h6)); 

h6 = abs(h6);
ind = find(w6>fp);
ind = ind(1);
h61 = h6(1:ind);
maxpass = max(h61)-1;
minpass = 1-min(h61);
del_p = max(maxpass,minpass);

ind2 = find(w6>0.36);
ind2 = ind2(1);
h62 = h6(ind2:end);
maxpass2 = max(h62);
del_s = maxpass2;

% There are five alternation points in the passband
% There are 11 alternation points in the stopband

fp = 0.33;
h = firpm(28, [0 fp 0.36 1], [1 1 0 0]);
n = (0:28);
[h6,w6] = freqz(h);
w6 = w6/pi;
figure;
plot(w6,abs(h6)); 

h6 = abs(h6);
ind = find(w6>fp);
ind = ind(1);
h61 = h6(1:ind);
maxpass = max(h61)-1;
minpass = 1-min(h61);
del_p = max(maxpass,minpass);

ind2 = find(w6>0.36);
ind2 = ind2(1);
h62 = h6(ind2:end);
maxpass2 = max(h62);
del_s = maxpass2;

% There are six alternation points in the passband
% There are 10 alternation points in the stopband

%% 9 - Varying the Transition Bandwidth
tbw = 0.15
h = firpm(28, [0 0.33-tbw 0.33+tbw 1], [1 1 0 0]);
fp = 0.33-tbw;
fs = 0.33+tbw;
n = (0:28);
[h7,w7] = freqz(h);
w7 = w7/pi;
figure;
plot(w7,abs(h7)); 

h7 = abs(h7);
ind = find(w7>fp);
ind = ind(1);
h71 = h7(1:ind);
maxpass = max(h71)-1;
minpass = 1-min(h71);
del_p = max(maxpass,minpass);

ind2 = find(w7>fs);
ind2 = ind2(1);
h72 = h7(ind2:end);
maxpass2 = max(h72);
del_s = maxpass2;

tbw = 0.01
h = firpm(28, [0 0.33-tbw 0.33+tbw 1], [1 1 0 0]);
fp = 0.33 - tbw;
fs = 0.33 + tbw;
n = (0:28);
[h8,w8] = freqz(h);
w8 = w8/pi;
figure;
plot(w8,abs(h8)); 

h8 = abs(h8);
ind = find(w8>fp);
ind = ind(1);
h81 = h8(1:ind);
maxpass = max(h81)-1;
minpass = 1-min(h81);
del_p = max(maxpass,minpass);

ind2 = find(w8>fs);
ind2 = ind2(1);
h82 = h8(ind2:end);
maxpass2 = max(h82);
del_s = maxpass2;

%% 10 - Optimal vs. Window FIR Design

wp = 0.1955;
ws = 0.4329;
h = firpm(28, [0 wp ws 1], [1 1 0 0]);
n = (0:28);
[h9,w9] = freqz(h);
h9 = abs(h9);
w9 = w9/pi;

ind1 = find(w9>wp);
ind1 = ind1(1);
h91 = h9(1:ind1);
maxpass = max(h91)-1;
minpass = 1-min(h91);
del_p = max(maxpass,minpass);

ind2 = find(w9>ws);
ind2 = ind2(1);
h92 = h9(ind2:end);
maxpass2 = max(h92);
del_s = maxpass2;

figure;
plot(w9,h9);
axis([0 wp .998, 1.002]);

figure;
plot(w9,h9);
axis([ws 1 0 .004]);

% This is better than the filter designed with the window method because
% the del_p and del_s values are reduced

%% 11 - Changing Filter Length

h = firpm(38, [0 0.3 0.36 1], [1 1 0 0 ]);
n = (0:28);
[H,W] = freqz(h);
H = abs(H);
W = W/pi;

figure;
hold on;
plot(W,H,'r');
plot(W,h5);
title('29- and 39-Length Filters');
xlabel('Frequency (Hz)');
ylabel('Amplitude');
hleg1 = legend('Length: 39','Length: 29');

ind1 = find(W>0.3);
ind1 = ind1(1);
H1 = H(1:ind1);
maxpass = max(H1)-1;
minpass = 1-min(H1);
del_p = max(maxpass,minpass);

ind2 = find(W>0.36);
ind2 = ind2(1);
H2 = H(ind2:end);
maxpass2 = max(H2);
del_s = maxpass2;

%% 12 - Optimal FIR vs. Elliptic IIR Design

h = firpm(102, [0 0.45 0.5 1], [1 1 0 0], [5 1]);
n = (0:102);
[H,W] = freqz(h);
H = abs(H);
maxH = max(H);
W = W/pi;

ind1 = find(W>0.45);
ind1 = ind1(1);
H1 = H(1:ind1);
maxpass = max(H1)-1;
minpass = 1-min(H1);
del_p = max(maxpass,minpass);

ind2 = find(W>0.5);
ind2 = ind2(1);
H3 = H(ind2:end);
maxpass2 = max(H3);
del_s = maxpass2;

h = firpm(89, [0 0.45 0.5 1], [1-del_p 1-del_p 0 0], [2.56 1]);
[H,W] = freqz(h);
H = abs(H);
maxH2 = max(H);
W = W/pi;

figure;
plot(W,H);
axis([0 1 0 1.1]);

H2 = 20*log10(H);
figure;
plot(W,H2)
axis([0 1 -110 5]);

ind1 = find(W>0.45);
ind1 = ind1(1);
ind1 = H2(1:ind1);
maxpass = max(ind1);
minpass = min(ind1);
idrip = maxpass-minpass; % ripple
ind2 = find(W>0.5);
ind2 = ind2(1);
ind2 = H2(ind2:end);
maxpass = max(ind2);
atten = minpass-maxpass;

% The length of the FIR filter is 90, the order is 89

% The order of the elliptic IIR filter is 7, so:
% 2(7)+1 = 15 multiplications per output sample are required for the elliptic IIR
% filter, where n is the order of the IIR filter.

% The order is 89, so 89 multiplcations per output sample are required for the optimal FIR
% filter using direct convolution, where n is the order of the FIR filter.

% The error weighting of the passband: 2.56
% The error weighting of the stopband: 1
##### SOURCE END #####
--></body></html>